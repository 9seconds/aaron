#!/bin/sh

SCRIPT_PATH="$(readlink "$0")"
SCRIPT_DIR="$(dirname "$SCRIPT_PATH")"

OUTPUT_DIR="$(readlink -m "$1")"
mkdir -p "$OUTPUT_DIR" || true

cd "${FEEDER_DIR:-$(dirname "$SCRIPT_DIR")/src}"

rm -f "$OUTPUT_DIR/$2.xml.gz"
scrapy crawl -O "$OUTPUT_DIR/$2.xml:atom" "$2"
zopfli --i1000 "$OUTPUT_DIR/$2.xml"
